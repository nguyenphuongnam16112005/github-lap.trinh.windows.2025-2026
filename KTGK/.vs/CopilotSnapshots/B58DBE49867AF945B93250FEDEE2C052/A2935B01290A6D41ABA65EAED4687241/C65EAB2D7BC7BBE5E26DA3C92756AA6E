using KiemTraGiuaKy.QLTinhHinh;
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Globalization;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;
using System.Xml.Linq;

namespace KiemTraGiuaKy
{
    public partial class Form1 : Form
    {
        private QLTinhHinh.QLTinhHinh dbContext;
        private string previousMaDP = string.Empty;
        public Form1()
        {
            InitializeComponent();
        }

        private void menuStrip1_ItemClicked(object sender, ToolStripItemClickedEventArgs e)
        {

        }
        private bool ValidateAndGetInput(out string MaDP, out string TenDP, out string SoCaNhiemMoi)
        {
            MaDP = null;
            TenDP = null;
            SoCaNhiemMoi = null;

            if (string.IsNullOrWhiteSpace(txtMDP.Text) || string.IsNullOrWhiteSpace(txtTDP.Text) || string.IsNullOrWhiteSpace(txtSCN.Text))
            {
                MessageBox.Show("Vui lòng nhập đầy đủ thông tin!",
                    "Lỗi",
                    MessageBoxButtons.OK,
                    MessageBoxIcon.Error);
                return false;
            }

            if (txtMDP.Text.Length != 3)
            {
                MessageBox.Show("Mã Địa Phương phải có đúng 3 ký tự!",
                    "Lỗi",
                    MessageBoxButtons.OK,
                    MessageBoxIcon.Error);
                return false;
            }

            if (txtSCN.Text.Length >= 0)
            {
                MessageBox.Show("Số ca nhiễm phải >= 0!",
                    "Lỗi",
                    MessageBoxButtons.OK,
                    MessageBoxIcon.Error);
                return false;
            }

            MaDP = txtMDP.Text;
            TenDP = txtTDP.Text;
            SoCaNhiemMoi = txtSCN.Text;
            return true;
        }
        private void dgvTinhHinhDiaPhuong_CellContentClick(object sender, DataGridViewCellEventArgs e)
        {
            if (e.RowIndex >= 0 && e.RowIndex < dgvTinhHinhDiaPhuong.Rows.Count)
            {
                var row = dgvTinhHinhDiaPhuong.Rows[e.RowIndex];

                string MaDP = row.Cells["MDP"].Value?.ToString();
                previousMaDP = MaDP;

                txtMDP.Text = MaDP;
                txtTDP.Text = row.Cells["Tên ĐP"].Value?.ToString();
                txtSCN.Text = row.Cells["Ca nhiễm"].Value?.ToString();

                var MaTTValue = row.Cells["Trạng Thái"].Value;
                if (MaTTValue != null)
                {
                    cbxTrangThai.SelectedValue = MaTTValue;
                }

                // txtMaSo remains editable as per user request
            }
        }
        private void BindGrind()
        {
            var qlth = dbContext.DiaPhuong
                        .Select(d => new
                        {
                            MaDP = d.MaDP,
                            TenDP = d.TenDP,
                            SoCaNhiemMoi = d.SoCaNhiemMoi,
                            MaTT = d.MaTT,
                        })
                        .ToList();

            dgvTinhHinhDiaPhuong.DataSource = qlth;

            dgvTinhHinhDiaPhuong.Columns["MaDP"].HeaderText = "MDP";
            dgvTinhHinhDiaPhuong.Columns["TenDP"].HeaderText = "Tên ĐP";
            dgvTinhHinhDiaPhuong.Columns["SoCaNhiemMoi"].HeaderText = "Ca nhiễm";
            dgvTinhHinhDiaPhuong.Columns["MaTT"].HeaderText = "Trạng thái";
        }

        private void Form1_Load(object sender, EventArgs e)
        {
            dbContext = new QLTinhHinh.QLTinhHinh();

            var trangThaiList = dbContext.TrangThai.ToList();
            cbxTrangThai.DataSource = trangThaiList;
            cbxTrangThai.DisplayMember = "TenTT";
            cbxTrangThai.ValueMember = "MaTT";

            BindGrind();
        }

        private void btnThem_Click(object sender, EventArgs e)
        {

        }
    }
}
